<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Settings Creator — MedicLog</title>
    <meta name="description" content="Customize MedicLog display settings visually and generate a QR code to import them instantly.">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .creator-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .creator-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .creator-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
        }

        .creator-header .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        /* Main layout: settings left, preview right */
        .creator-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 900px) {
            .creator-layout {
                grid-template-columns: 1fr;
            }
            .preview-panel {
                order: -1;
            }
        }

        /* Settings Panel */
        .settings-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .settings-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .settings-section h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-section h3 svg {
            width: 20px;
            height: 20px;
            fill: var(--accent);
        }

        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .setting-label span {
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .setting-label small {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Toggle switch */
        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--border);
            border-radius: 24px;
            transition: 0.2s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.2s;
        }

        .toggle input:checked + .toggle-slider {
            background: var(--accent);
        }

        .toggle input:checked + .toggle-slider::before {
            transform: translateX(20px);
        }

        /* Screen tags - indicate which screen a setting affects */
        .screen-tag {
            display: inline-block;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 1px 5px;
            border-radius: 4px;
            background: var(--accent);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            vertical-align: middle;
            margin-left: 4px;
        }

        /* Segmented control */
        .segmented {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 3px;
            gap: 2px;
        }

        .segmented label {
            flex: 1;
            text-align: center;
            padding: 0.4rem 0.75rem;
            font-size: 0.85rem;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .segmented input {
            display: none;
        }

        .segmented input:checked + label {
            background: var(--accent);
            color: white;
            font-weight: 500;
        }

        /* Vitals checkboxes grid */
        .vitals-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        @media (max-width: 500px) {
            .vitals-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .vitals-grid label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all 0.15s;
        }

        .vitals-grid label:hover {
            background: var(--highlight-bg);
        }

        .vitals-grid input:checked + span {
            color: var(--accent);
            font-weight: 500;
        }

        .vitals-grid input {
            accent-color: var(--accent);
        }

        /* Preview Panel */
        .preview-panel {
            position: sticky;
            top: 100px;
        }

        .preview-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .preview-card h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Phone mockup */
        .phone-mockup {
            background: #1a1a1a;
            border-radius: 32px;
            padding: 12px;
            margin: 0 auto 1.5rem;
            max-width: 280px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .phone-screen {
            border-radius: 24px;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Preview screen content - mimics MedicLog active call */
        .preview-screen {
            height: 520px;
            padding: 0;
            transition: background 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-screen.light {
            background: #f2f2f7;
            color: #1c1c1e;
        }

        .preview-screen.dark {
            background: #1c1c1e;
            color: #f2f2f7;
        }

        /* Status bar - iOS style */
        .preview-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 12px;
            font-size: 9px;
            font-weight: 600;
        }
        .preview-screen.dark .preview-status-bar { color: #fff; }
        .preview-screen.light .preview-status-bar { color: #000; }
        .status-icons { display: flex; gap: 3px; align-items: center; }
        .status-icons svg { width: 10px; height: 10px; }
        .preview-screen.dark .status-icons svg { fill: #fff; }
        .preview-screen.light .status-icons svg { fill: #000; }

        /* Action bar - End Call, Report, icons */
        .preview-action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 12px;
        }
        .end-call-btn {
            background: #ff3b30;
            color: white;
            font-size: 9px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            border: none;
        }
        .report-link {
            color: #007aff;
            font-size: 11px;
            font-weight: 500;
        }
        .action-icons {
            display: flex;
            gap: 12px;
        }
        .action-icons svg {
            width: 14px;
            height: 14px;
        }
        .preview-screen.dark .action-icons svg { fill: #fff; }
        .preview-screen.light .action-icons svg { fill: #000; }

        /* Timer grid - matches ActiveCallPhoneView.swift TimerBox */
        .preview-timers {
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        /* Responsive grid based on visible timer count */
        .preview-timers.grid-1 { grid-template-columns: 1fr; }
        .preview-timers.grid-2 { grid-template-columns: repeat(2, 1fr); }
        .preview-timers.grid-3 { grid-template-columns: repeat(3, 1fr); }
        .preview-timers.grid-4 { grid-template-columns: repeat(2, 1fr); }

        .timer-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: 6px 4px;
            border-radius: 8px;
            min-height: 44px;
        }

        .timer-box .timer-label {
            font-size: 8px;
            font-weight: 500;
            opacity: 0.9;
        }

        .timer-box .timer-duration {
            font-family: 'SF Mono', Menlo, monospace;
            font-size: 16px;
            font-weight: 700;
        }

        /* Timer colors - 15% bg opacity, 30% border per TimerBox */
        .timer-box.call {
            background: rgba(52, 199, 89, 0.15);
            border: 1px solid rgba(52, 199, 89, 0.3);
            color: #34c759;
        }

        .timer-box.epi {
            background: rgba(255, 149, 0, 0.15);
            border: 1px solid rgba(255, 149, 0, 0.3);
            color: #ff9500;
        }

        .timer-box.sedation {
            background: rgba(175, 82, 222, 0.15);
            border: 1px solid rgba(175, 82, 222, 0.3);
            color: #af52de;
        }

        .timer-box.cardiac {
            background: rgba(255, 59, 48, 0.15);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: #ff3b30;
        }

        /* Overdue state - red border */
        .timer-box.overdue {
            border: 2px solid #ff3b30 !important;
        }

        .timer-box.overdue .timer-duration {
            color: #ff3b30;
        }

        .timer-box.hidden {
            display: none;
        }

        /* Quick Entry toolbar - matches ActiveCallPhoneView.swift QuickEntryButton */
        .quick-entry-toolbar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 8px 12px;
        }

        .qe-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 4px;
        }

        /* Icon container: 50x50 in app, scaled down to ~28x28 for mockup */
        .qe-button .qe-icon {
            width: 28px;
            height: 28px;
            border-radius: 7px;  /* cornerRadius(12) scaled: 12 * 28/50 ≈ 7 */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qe-button .qe-icon svg {
            width: 14px;
            height: 14px;
            fill: white;
        }

        .qe-button span {
            font-size: 8px;
            font-weight: 500;
        }

        .preview-screen.light .qe-button span { color: #000; }
        .preview-screen.dark .qe-button span { color: #fff; }

        /* Quick Entry icon colors */
        .qe-button.vitals .qe-icon { background: #ff9500; }
        .qe-button.med .qe-icon { background: #34c759; }
        .qe-button.cardiac .qe-icon { background: #ff3b30; }
        .qe-button.iv .qe-icon { background: #007aff; }
        .qe-button.proc .qe-icon { background: #af52de; }
        .qe-button.note .qe-icon { background: #8e8e93; }
        .qe-button.trauma .qe-icon { background: #ff2d55; }
        .qe-button.photo .qe-icon { background: #5ac8fa; }

        /* Log entries - matches EntryRow from ActiveCallPhoneView.swift */
        .preview-log {
            padding: 4px 8px;
            flex: 1;
            overflow-y: auto;
        }

        .log-entry {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
        }

        /* Time: 16pt semibold monospaced, 50px width in app → scaled to ~30px */
        .log-time {
            font-family: 'SF Mono', Menlo, monospace;
            font-size: 10px;
            font-weight: 600;
            width: 34px;
            flex-shrink: 0;
        }

        .preview-screen.light .log-time { color: #000; }
        .preview-screen.dark .log-time { color: #fff; }

        /* Icon: 24px width in app → scaled to ~16px */
        .log-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .log-icon svg {
            width: 14px;
            height: 14px;
        }

        /* Icon colors matching LogEntry.EntryType.iconColor */
        .log-icon.medication svg { fill: #34c759; }
        .log-icon.cardiac svg { stroke: #ff3b30; fill: none; stroke-width: 2; }
        .log-icon.access svg { fill: #007aff; }
        .log-icon.vitals svg { fill: #ff9500; }
        .log-icon.procedure svg { fill: #af52de; }
        .log-icon.status svg { fill: #af52de; }  /* Purple for transport/status */

        /* Content: 15pt in app → scaled to ~10px */
        .log-content {
            flex: 1;
            font-size: 10px;
            line-height: 1.3;
        }

        .preview-screen.light .log-content { color: #000; }
        .preview-screen.dark .log-content { color: #fff; }

        /* Bottom action buttons - Voice Log + Add Entry */
        .preview-bottom-buttons {
            display: flex;
            gap: 8px;
            padding: 8px 12px;
        }
        .bottom-btn {
            flex: 1;
            padding: 8px 0;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        .bottom-btn svg { width: 12px; height: 12px; fill: white; }
        .bottom-btn.voice { background: #007aff; }
        .bottom-btn.add { background: #ff9500; }

        /* Tab bar */
        .preview-tab-bar {
            display: flex;
            justify-content: space-around;
            padding: 6px 0 4px;
            border-top: 1px solid #3a3a3c;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            font-size: 7px;
        }
        .tab-item svg { width: 16px; height: 16px; }
        .tab-item.active { color: #007aff; }
        .tab-item.active svg { fill: #007aff; }
        .preview-screen.dark .tab-item:not(.active) { color: #8e8e93; }
        .preview-screen.dark .tab-item:not(.active) svg { fill: #8e8e93; }
        .preview-screen.light .tab-item:not(.active) { color: #8e8e93; }
        .preview-screen.light .tab-item:not(.active) svg { fill: #8e8e93; }

        /* QR Section */
        .qr-section {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .qr-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            display: inline-block;
            margin-bottom: 0.75rem;
        }

        .qr-container canvas {
            display: block;
        }

        .qr-instruction {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .generate-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            margin-bottom: 1rem;
        }

        .generate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        .generate-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Summary */
        .settings-summary {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.75rem;
            text-align: center;
        }

        /* Back link */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent);
            text-decoration: none;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .back-link svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Scenario toggle */
        .scenario-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .scenario-btn {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .scenario-btn:hover {
            border-color: var(--text-muted);
        }

        .scenario-btn.selected {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }


        /* Text inputs and selects */
        .text-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.9rem;
            min-width: 140px;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .select-input {
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.85rem;
            min-width: 120px;
            cursor: pointer;
        }

        .select-input:focus {
            outline: none;
            border-color: var(--accent);
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-inner">
            <a href="index.html" class="nav-brand">
                <img src="icon.png" alt="MedicLog">
                MedicLog
            </a>
            <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">&#9776;</button>
            <div class="nav-links">
                <a href="docs.html">Docs</a>
                <a href="transfer.html">Transfer</a>
                <a href="tutorial.html">Tutorial</a>
                <a href="shortcuts.html">Shortcuts</a>
                <a href="faq.html">FAQ</a>
                <a href="privacy.html">Privacy</a>
            </div>
        </div>
    </nav>

    <main class="creator-container">
        <a href="presets.html" class="back-link">
            <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            Back to Role Presets
        </a>

        <header class="creator-header">
            <h1>Settings Creator</h1>
            <p class="subtitle">Configure MedicLog settings and generate a QR code to apply them instantly</p>
        </header>

        <div class="creator-layout">
            <!-- Settings Panel -->
            <div class="settings-panel">

                <!-- Appearance -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                        Appearance
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Theme</span>
                        </div>
                        <div class="segmented">
                            <input type="radio" name="theme" id="theme-system" value="0" checked>
                            <label for="theme-system">System</label>
                            <input type="radio" name="theme" id="theme-light" value="1">
                            <label for="theme-light">Light</label>
                            <input type="radio" name="theme" id="theme-dark" value="2">
                            <label for="theme-dark">Dark</label>
                        </div>
                    </div>
                </section>

                <!-- Timer & Screen -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                        Timer & Screen
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Call Timer</span>
                            <small>Elapsed call time in timer grid</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showCallTimer" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Medication Timers</span>
                            <small>Countdown timers for meds</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showMedicationTimers" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Keep Screen Awake</span>
                            <small>Prevent dimming during calls</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="keepScreenAwake" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Patient Info Button</span>
                            <small>Quick access to demographics (iPad)</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showPatientInfoButton">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Time & Date Format -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                        Time & Date Format
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>24-Hour Time</span>
                            <small>14:30 instead of 2:30 PM</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="use24HourTime" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>UTC Time (Zulu)</span>
                            <small>For flight medics</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="useUTCTime">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Military Date Format</span>
                            <small>14FEB2026 instead of locale</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="useMilitaryDate">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Timeline Display -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
                        Timeline Display
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Group Active Call Entries</span>
                            <small>By type instead of chronological <span class="screen-tag">Active Call</span></small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="groupActiveCallEntries">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Group History Entries</span>
                            <small>By type in call history <span class="screen-tag">History</span></small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="groupHistoryEntries">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Group Medications by Type</span>
                            <small>Cardiac, Respiratory, etc. <span class="screen-tag">Med Entry</span></small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="groupMedicationsByType" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Vitals Collapsed Display -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        Vitals Collapsed Display
                    </h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem;">Select which vitals appear in collapsed timeline entries</p>
                    <div class="vitals-grid">
                        <label><input type="checkbox" id="vitals-bp" checked> <span>Blood Pressure</span></label>
                        <label><input type="checkbox" id="vitals-hr" checked> <span>Heart Rate</span></label>
                        <label><input type="checkbox" id="vitals-rr" checked> <span>Resp Rate</span></label>
                        <label><input type="checkbox" id="vitals-spo2"> <span>SpO₂</span></label>
                        <label><input type="checkbox" id="vitals-temp"> <span>Temperature</span></label>
                        <label><input type="checkbox" id="vitals-etco2"> <span>ETCO₂</span></label>
                        <label><input type="checkbox" id="vitals-glucose"> <span>Blood Glucose</span></label>
                        <label><input type="checkbox" id="vitals-pain"> <span>Pain Scale</span></label>
                        <label><input type="checkbox" id="vitals-gcs"> <span>GCS</span></label>
                    </div>
                </section>

                <!-- Agency Configuration -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></svg>
                        Agency Configuration
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Agency Name</span>
                            <small>Your service or department name</small>
                        </div>
                        <input type="text" id="agencyName" placeholder="Ambulance Service" class="text-input">
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Use Incident Numbers</span>
                            <small>Track calls by incident number</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="useIncidentNumbers" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show PHI Warnings</span>
                            <small>Warn before sharing protected data</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showPHIWarnings" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Test Data Tools</span>
                            <small>Enable sample data generators</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showTestDataTools" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Handoff in Share Menu</span>
                            <small>Quick access to hospital handoff</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showHandoffInShareMenu" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Stroke Scale</span>
                            <small>Default stroke assessment tool</small>
                        </div>
                        <select id="strokeScale" class="select-input">
                            <option value="cincinnati" selected>Cincinnati</option>
                            <option value="lams">LAMS</option>
                            <option value="fast-ed">FAST-ED</option>
                            <option value="race">RACE</option>
                            <option value="nihss">NIHSS</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>End of Call Action</span>
                            <small>What happens when call ends</small>
                        </div>
                        <select id="endOfCallAction" class="select-input">
                            <option value="hospital" selected>Prompt Hospital Handoff</option>
                            <option value="save">Save Silently</option>
                            <option value="export">Show Export Options</option>
                        </select>
                    </div>
                </section>

                <!-- Cardiac Options -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>
                        Cardiac Procedures
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Vector Change</span>
                            <small>Defibrillator pad swap option</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showVectorChange" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Dual Sequential</span>
                            <small>Double defibrillation option</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showDualSequential" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Quick Entry Buttons -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></svg>
                        Quick Entry Buttons
                    </h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem;">Which buttons appear during active calls</p>
                    <div class="vitals-grid">
                        <label><input type="checkbox" id="qe-vitals"> <span>Vitals</span></label>
                        <label><input type="checkbox" id="qe-medication" checked> <span>Medication</span></label>
                        <label><input type="checkbox" id="qe-cardiac" checked> <span>Cardiac</span></label>
                        <label><input type="checkbox" id="qe-iv" checked> <span>IV Access</span></label>
                        <label><input type="checkbox" id="qe-procedure" checked> <span>Procedures</span></label>
                        <label><input type="checkbox" id="qe-note" checked> <span>Notes</span></label>
                    </div>
                    <div class="setting-row" style="margin-top: 0.75rem;">
                        <div class="setting-label">
                            <span>Default IV Gauge</span>
                        </div>
                        <select id="defaultIVGauge" class="select-input">
                            <option value="14g">14g</option>
                            <option value="16g">16g</option>
                            <option value="18g" selected>18g</option>
                            <option value="20g">20g</option>
                            <option value="22g">22g</option>
                            <option value="24g">24g</option>
                        </select>
                    </div>
                </section>

                <!-- Watch Configuration -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M20 12c0-2.54-1.19-4.81-3.04-6.27L16 0H8l-.95 5.73C5.19 7.19 4 9.45 4 12s1.19 4.81 3.05 6.27L8 24h8l.96-5.73C18.81 16.81 20 14.54 20 12zM6 12c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z"/></svg>
                        Watch Configuration
                        <span class="screen-tag" style="margin-left: 8px;">Watch App</span>
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Enable Watch Connectivity</span>
                            <small>Sync with Apple Watch app</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showWatchConnectivity" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Watch Voice Mode</span>
                            <small>How Watch handles voice input</small>
                        </div>
                        <select id="watchVoiceMode" class="select-input">
                            <option value="auto" selected>Auto</option>
                            <option value="tap">Tap to Speak</option>
                            <option value="always">Always Listening</option>
                        </select>
                    </div>
                </section>

                <!-- Vitals Settings -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"/></svg>
                        Vitals Settings
                    </h3>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Vitals Button</span>
                            <small>In quick entry toolbar</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="showVitalsButton" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Radio Report: Full Vitals</span>
                            <small>Show trending arrows in reports</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="radioShowFullVitals" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Vitals Reminder</span>
                            <small>Periodic reassessment timer</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="vitalsReminderEnabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Reminder Interval</span>
                        </div>
                        <select id="vitalsReminderInterval" class="select-input">
                            <option value="300" selected>5 min</option>
                            <option value="600">10 min</option>
                            <option value="900">15 min</option>
                            <option value="1800">30 min</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <div class="setting-label">
                            <span>Show Math Helpers</span>
                            <small>MAP, Shock Index calculations</small>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="vitalsShowMathHelper" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </section>

                <!-- Export Settings -->
                <section class="settings-section">
                    <h3>
                        <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                        Export Settings
                    </h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.75rem;">Which export formats are enabled</p>
                    <div class="vitals-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <label><input type="checkbox" id="export-pdf" checked> <span>PDF</span></label>
                        <label><input type="checkbox" id="export-text" checked> <span>Text</span></label>
                        <label><input type="checkbox" id="export-csv" checked> <span>CSV</span></label>
                    </div>
                </section>

            </div>

            <!-- Preview Panel -->
            <div class="preview-panel">
                <div class="preview-card">
                    <h3>Live Preview</h3>

                    <!-- Scenario Toggle -->
                    <div class="scenario-toggle">
                        <button class="scenario-btn selected" data-scenario="cardiac" onclick="setScenario('cardiac')">Cardiac Arrest</button>
                        <button class="scenario-btn" data-scenario="clean" onclick="setScenario('clean')">Clean Call</button>
                    </div>

                    <div class="phone-mockup">
                        <div class="phone-screen">
                            <div class="preview-screen dark" id="preview-screen">
                                <!-- Status bar -->
                                <div class="preview-status-bar">
                                    <span id="preview-time">9:42</span>
                                    <div class="status-icons">
                                        <svg viewBox="0 0 24 24"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>
                                        <svg viewBox="0 0 24 24"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></svg>
                                    </div>
                                </div>

                                <!-- Action bar: End Call | Report | Icons -->
                                <div class="preview-action-bar">
                                    <button class="end-call-btn">End Call</button>
                                    <span class="report-link">Report</span>
                                    <div class="action-icons">
                                        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                                        <svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/></svg>
                                    </div>
                                </div>

                                <div class="preview-timers grid-3" id="preview-timers">
                                    <!-- Matches screenshot: Call, Fentanyl (overdue), Epi -->
                                    <div class="timer-box call" id="timer-call">
                                        <span class="timer-label">Call</span>
                                        <span class="timer-duration">30:23</span>
                                    </div>
                                    <div class="timer-box sedation overdue med-timer" id="timer-fentanyl">
                                        <span class="timer-label">Fentanyl</span>
                                        <span class="timer-duration">-1m</span>
                                    </div>
                                    <div class="timer-box epi med-timer" id="timer-epi">
                                        <span class="timer-label">Epi 1:10,000</span>
                                        <span class="timer-duration">2m</span>
                                    </div>
                                    <!-- Extended timers for busy scenario -->
                                    <div class="timer-box sedation med-timer hidden" id="timer-ketamine">
                                        <span class="timer-label">Ketamine</span>
                                        <span class="timer-duration">8:42</span>
                                    </div>
                                    <div class="timer-box cardiac med-timer hidden" id="timer-atropine">
                                        <span class="timer-label">Atropine</span>
                                        <span class="timer-duration">3:15</span>
                                    </div>
                                </div>

                                <!-- Quick Entry Toolbar -->
                                <div class="quick-entry-toolbar">
                                    <div class="qe-button vitals">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/></svg></div>
                                        <span>Vitals</span>
                                    </div>
                                    <div class="qe-button med">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><path d="M4.22 11.29l9.07-9.07a5.25 5.25 0 017.42 7.42l-9.07 9.07a5.25 5.25 0 01-7.42-7.42z"/></svg></div>
                                        <span>Med</span>
                                    </div>
                                    <div class="qe-button cardiac">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><path d="M2 12h4l2-4 3 8 2-4h9" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"/></svg></div>
                                        <span>Cardiac</span>
                                    </div>
                                    <div class="qe-button iv">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><path d="M12 2.5c-4.5 6.5-7 10.5-7 13.5a7 7 0 1014 0c0-3-2.5-7-7-13.5z"/></svg></div>
                                        <span>IV</span>
                                    </div>
                                    <div class="qe-button proc">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg></div>
                                        <span>Proc</span>
                                    </div>
                                    <div class="qe-button note">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
                                        <span>Note</span>
                                    </div>
                                    <div class="qe-button trauma">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"/></svg></div>
                                        <span>Trauma</span>
                                    </div>
                                    <div class="qe-button photo">
                                        <div class="qe-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9z"/></svg></div>
                                        <span>Photo</span>
                                    </div>
                                </div>

                                <div class="preview-log" id="preview-log">
                                    <!-- Populated by setScenario() -->
                                </div>

                                <!-- Bottom action buttons -->
                                <div class="preview-bottom-buttons">
                                    <button class="bottom-btn voice">
                                        <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                                        Voice Log
                                    </button>
                                    <button class="bottom-btn add">
                                        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                                        Add Entry
                                    </button>
                                </div>

                                <!-- Tab bar -->
                                <div class="preview-tab-bar">
                                    <div class="tab-item active">
                                        <svg viewBox="0 0 24 24"><path d="M2 12h4l2-4 3 8 2-4h9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                                        <span>Active</span>
                                    </div>
                                    <div class="tab-item">
                                        <svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
                                        <span>History</span>
                                    </div>
                                    <div class="tab-item">
                                        <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                                        <span>Destinations</span>
                                    </div>
                                    <div class="tab-item">
                                        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                                        <span>Settings</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="generate-btn" onclick="generateQR()">
                        <svg viewBox="0 0 24 24"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm8 0h2v2h-2v2h2v-2h2v2h2v-2h-2v-2h2v-2h-2v2h-2v-2h-2v2zm0 4h2v2h-2zm4 0h2v2h-2z"/></svg>
                        Generate QR Code
                    </button>

                    <div class="qr-section" id="qr-section" style="display: none;">
                        <div class="qr-container">
                            <canvas id="qr-canvas"></canvas>
                        </div>
                        <p class="qr-instruction">Scan with your iPhone camera to import settings</p>
                        <p class="settings-summary" id="settings-summary"></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 MedicLog &middot; <a href="privacy.html">Privacy</a> &middot; <a href="https://github.com/MedicLog/mediclog-support/issues">Support</a></p>
    </footer>

    <script>
        // Current scenario
        let currentScenario = 'cardiac';

        // SF Symbol SVG icons matching LogEntry.EntryType.icon
        const sfSymbols = {
            medication: '<svg viewBox="0 0 24 24"><path d="M4.22 11.29l9.07-9.07a5.25 5.25 0 017.42 7.42l-9.07 9.07a5.25 5.25 0 01-7.42-7.42z"/></svg>',
            cardiac: '<svg viewBox="0 0 24 24"><path d="M2 12h4l2-4 3 8 2-4h9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            access: '<svg viewBox="0 0 24 24"><path d="M12 2.5c-4.5 6.5-7 10.5-7 13.5a7 7 0 1014 0c0-3-2.5-7-7-13.5z"/></svg>',
            vitals: '<svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>',
            procedure: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8M12 8v8" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>',
            status: '<svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>'
        };

        // Scenario data - matches screenshot exactly
        const scenarios = {
            cardiac: {
                times24: ['19:33', '19:32', '19:29', '19:26', '19:23', '19:19'],
                times12: ['7:33', '7:32', '7:29', '7:26', '7:23', '7:19'],
                entries: [
                    { type: 'medication', text: 'Epi 1:10,000 1.0mg IV' },
                    { type: 'medication', text: 'Ondansetron (Zofran) 4.0mg IV' },
                    { type: 'medication', text: 'Nitroglycerin 0.4mg SL' },
                    { type: 'status', text: 'Transported to Regional Medical Center' },
                    { type: 'medication', text: 'Fentanyl 50.0mcg IV' },
                    { type: 'vitals', text: 'VITALS_COLLAPSED' }
                ]
            },
            clean: {
                times24: ['14:20'],
                times12: ['2:20'],
                entries: [
                    { type: 'status', text: 'Call Started' }
                ]
            }
        };

        // Get all settings elements
        const settings = {
            // Theme
            theme: () => parseInt(document.querySelector('input[name="theme"]:checked').value),

            // Timer & Screen
            showCallTimer: () => document.getElementById('showCallTimer').checked,
            showMedicationTimers: () => document.getElementById('showMedicationTimers').checked,
            keepScreenAwake: () => document.getElementById('keepScreenAwake').checked,
            showPatientInfoButton: () => document.getElementById('showPatientInfoButton').checked,

            // Time & Date
            use24HourTime: () => document.getElementById('use24HourTime').checked,
            useUTCTime: () => document.getElementById('useUTCTime').checked,
            useMilitaryDate: () => document.getElementById('useMilitaryDate').checked,

            // Timeline
            groupActiveCallEntries: () => document.getElementById('groupActiveCallEntries').checked,
            groupHistoryEntries: () => document.getElementById('groupHistoryEntries').checked,
            groupMedicationsByType: () => document.getElementById('groupMedicationsByType').checked,

            // Vitals collapsed
            vitalsCollapsed: () => ({
                showBP: document.getElementById('vitals-bp').checked,
                showHR: document.getElementById('vitals-hr').checked,
                showRR: document.getElementById('vitals-rr').checked,
                showSpO2: document.getElementById('vitals-spo2').checked,
                showTemp: document.getElementById('vitals-temp').checked,
                showETCO2: document.getElementById('vitals-etco2').checked,
                showGlucose: document.getElementById('vitals-glucose').checked,
                showPain: document.getElementById('vitals-pain').checked,
                showGCS: document.getElementById('vitals-gcs').checked
            }),

            // Agency
            agencyName: () => document.getElementById('agencyName').value.trim() || null,
            useIncidentNumbers: () => document.getElementById('useIncidentNumbers').checked,
            showPHIWarnings: () => document.getElementById('showPHIWarnings').checked,
            showTestDataTools: () => document.getElementById('showTestDataTools').checked,
            showHandoffInShareMenu: () => document.getElementById('showHandoffInShareMenu').checked,
            strokeScale: () => document.getElementById('strokeScale').value,
            endOfCallAction: () => document.getElementById('endOfCallAction').value,
            showVectorChange: () => document.getElementById('showVectorChange').checked,
            showDualSequential: () => document.getElementById('showDualSequential').checked,

            // Quick Entry
            quickEntry: () => ({
                vitals: document.getElementById('qe-vitals').checked,
                medication: document.getElementById('qe-medication').checked,
                cardiac: document.getElementById('qe-cardiac').checked,
                iv: document.getElementById('qe-iv').checked,
                procedure: document.getElementById('qe-procedure').checked,
                note: document.getElementById('qe-note').checked,
                defaultIVGauge: document.getElementById('defaultIVGauge').value
            }),

            // Watch
            showWatchConnectivity: () => document.getElementById('showWatchConnectivity').checked,
            watchVoiceMode: () => document.getElementById('watchVoiceMode').value,

            // Vitals settings
            showVitalsButton: () => document.getElementById('showVitalsButton').checked,
            radioShowFullVitals: () => document.getElementById('radioShowFullVitals').checked,
            vitalsReminderEnabled: () => document.getElementById('vitalsReminderEnabled').checked,
            vitalsReminderInterval: () => parseInt(document.getElementById('vitalsReminderInterval').value),
            vitalsShowMathHelper: () => document.getElementById('vitalsShowMathHelper').checked,

            // Export
            exportPDF: () => document.getElementById('export-pdf').checked,
            exportText: () => document.getElementById('export-text').checked,
            exportCSV: () => document.getElementById('export-csv').checked
        };

        // Build vitals string - matches screenshot "Blood Pressure: 102/68" format
        function getVitalsString() {
            // Screenshot shows "Blood Pressure: 102/68" as single entry
            return 'Blood Pressure: 102/68';
        }

        // Update timer grid based on settings
        function updateTimerGrid() {
            const showCall = settings.showCallTimer();
            const showMed = settings.showMedicationTimers();
            const timersContainer = document.getElementById('preview-timers');

            // Set Call timer visibility
            document.getElementById('timer-call').classList.toggle('hidden', !showCall);

            // Med timers: base timers always show, extended show when call timer hidden
            document.querySelectorAll('.med-timer').forEach(el => {
                const isExtendedTimer = (el.id === 'timer-ketamine' || el.id === 'timer-atropine');
                if (isExtendedTimer) {
                    el.classList.toggle('hidden', !(showMed && !showCall));
                } else {
                    el.classList.toggle('hidden', !showMed);
                }
            });

            // Count visible timers and update grid class
            const visibleTimers = timersContainer.querySelectorAll('.timer-box:not(.hidden)').length;
            timersContainer.className = 'preview-timers grid-' + Math.min(visibleTimers, 4);
        }

        // Set scenario and rebuild log - ONLY affects timers and log entries
        function setScenario(scenario) {
            currentScenario = scenario;

            // Update toggle buttons
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.dataset.scenario === scenario);
            });

            // Update timers visibility for clean scenario
            if (scenario === 'clean') {
                // Hide all med timers for clean call
                document.querySelectorAll('.med-timer').forEach(el => el.classList.add('hidden'));
                // Keep call timer based on setting
                const showCall = settings.showCallTimer();
                document.getElementById('timer-call').classList.toggle('hidden', !showCall);
                // Update grid class
                const timersContainer = document.getElementById('preview-timers');
                const visibleTimers = timersContainer.querySelectorAll('.timer-box:not(.hidden)').length;
                timersContainer.className = 'preview-timers grid-' + Math.min(visibleTimers, 4);
            } else {
                updateTimerGrid();
            }

            // Only rebuild log entries, don't touch anything else
            rebuildLogEntries();
        }

        // Rebuild just the log entries based on current scenario
        function rebuildLogEntries() {
            const use24 = settings.use24HourTime();
            const scenario = scenarios[currentScenario];
            const logContainer = document.getElementById('preview-log');
            logContainer.innerHTML = '';

            const times = use24 ? scenario.times24 : scenario.times12;
            scenario.entries.forEach((entry, i) => {
                const time = times[i] || times[times.length - 1];
                const timeDisplay = use24 ? time : time + ' PM';

                let text = entry.text;
                if (text === 'VITALS_COLLAPSED') {
                    text = getVitalsString();
                }

                const entryEl = document.createElement('div');
                entryEl.className = 'log-entry';
                entryEl.innerHTML = `
                    <span class="log-time">${timeDisplay}</span>
                    <span class="log-icon ${entry.type}">${sfSymbols[entry.type] || sfSymbols.status}</span>
                    <span class="log-content">${text}</span>
                `;
                logContainer.appendChild(entryEl);
            });
        }

        // Update preview when any setting changes
        function updatePreview() {
            const screen = document.getElementById('preview-screen');
            const theme = settings.theme();

            // Theme - only thing that affects the whole screen
            screen.classList.remove('light', 'dark');
            if (theme === 1) {
                screen.classList.add('light');
            } else if (theme === 2) {
                screen.classList.add('dark');
            } else {
                // System - use prefers-color-scheme
                if (window.matchMedia('(prefers-color-scheme: light)').matches) {
                    screen.classList.add('light');
                } else {
                    screen.classList.add('dark');
                }
            }

            // Timer grid - respects scenario
            if (currentScenario === 'cardiac') {
                updateTimerGrid();
            } else {
                document.getElementById('timer-call').classList.toggle('hidden', !settings.showCallTimer());
                document.querySelectorAll('.med-timer').forEach(el => el.classList.add('hidden'));
                const timersContainer = document.getElementById('preview-timers');
                const visibleTimers = timersContainer.querySelectorAll('.timer-box:not(.hidden)').length;
                timersContainer.className = 'preview-timers grid-' + Math.min(visibleTimers, 4);
            }

            // Rebuild log entries
            rebuildLogEntries();
        }

        // Generate QR code with quick_config payload
        function generateQR() {
            const qe = settings.quickEntry();

            const payload = {
                type: 'quick_config',
                configVersion: 1,
                exportedAt: new Date().toISOString(),

                // Agency configuration
                agency: {
                    name: settings.agencyName(),
                    useIncidentNumbers: settings.useIncidentNumbers(),
                    showPHIWarnings: settings.showPHIWarnings(),
                    showTestDataTools: settings.showTestDataTools(),
                    'cardiac.showVectorChange': settings.showVectorChange(),
                    'cardiac.showDualSequential': settings.showDualSequential(),
                    endOfCallAction: settings.endOfCallAction(),
                    'hospitalHandoff.showInShareMenu': settings.showHandoffInShareMenu(),
                    strokeScale: settings.strokeScale()
                },

                // Display preferences
                display: {
                    appearanceMode: settings.theme(),
                    use24HourTime: settings.use24HourTime(),
                    useUTCTime: settings.useUTCTime(),
                    useMilitaryDate: settings.useMilitaryDate(),
                    groupActiveCallEntries: settings.groupActiveCallEntries(),
                    groupHistoryEntries: settings.groupHistoryEntries(),
                    groupMedicationsByType: settings.groupMedicationsByType(),
                    keepScreenAwake: settings.keepScreenAwake(),
                    showCallTimer: settings.showCallTimer(),
                    showMedicationTimers: settings.showMedicationTimers(),
                    showPatientInfoButton: settings.showPatientInfoButton(),
                    vitalsCollapsed: settings.vitalsCollapsed()
                },

                // Quick entry buttons
                quickEntry: {
                    vitals: qe.vitals,
                    medication: qe.medication,
                    cardiac: qe.cardiac,
                    iv: qe.iv,
                    procedure: qe.procedure,
                    note: qe.note,
                    defaultIVGauge: qe.defaultIVGauge
                },

                // Watch settings
                watch: {
                    showWatchConnectivity: settings.showWatchConnectivity(),
                    watchVoiceMode: settings.watchVoiceMode()
                },

                // Vitals settings
                vitals: {
                    showVitalsButton: settings.showVitalsButton(),
                    radioShowFullVitals: settings.radioShowFullVitals(),
                    reminderEnabled: settings.vitalsReminderEnabled(),
                    reminderInterval: settings.vitalsReminderInterval(),
                    showMathHelper: settings.vitalsShowMathHelper()
                },

                // Export settings
                export: {
                    pdf: settings.exportPDF(),
                    text: settings.exportText(),
                    csv: settings.exportCSV()
                },

                page: 1,
                totalPages: 1
            };

            // Remove null agency name if not set
            if (!payload.agency.name) {
                delete payload.agency.name;
            }

            const json = JSON.stringify(payload);

            // Generate QR
            const canvas = document.getElementById('qr-canvas');
            QRCode.toCanvas(canvas, json, {
                width: 200,
                margin: 2,
                errorCorrectionLevel: 'M',
                color: {
                    dark: '#000000',
                    light: '#ffffff'
                }
            }, function(error) {
                if (error) {
                    console.error(error);
                    alert('Error generating QR code. The configuration may be too large for a single QR code. Try reducing settings.');
                    return;
                }

                // Show QR section
                document.getElementById('qr-section').style.display = 'block';

                // Summary - count configured sections
                let sections = [];
                if (settings.agencyName()) sections.push('Agency');
                sections.push('Display');
                sections.push('Quick Entry');
                sections.push('Watch');
                sections.push('Vitals');
                sections.push('Export');
                document.getElementById('settings-summary').textContent = `Configuration includes: ${sections.join(', ')}`;
            });
        }

        // Attach event listeners to all inputs and selects
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('change', updatePreview);
        });
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', updatePreview);
        });

        // Handle system theme changes
        window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', updatePreview);

        // Initial setup
        setScenario('cardiac');
    </script>
</body>
</html>
